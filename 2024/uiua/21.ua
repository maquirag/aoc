# AoC 2024/21 Keypad Conundrum
# TODO
# Experimental!
&fras "2024/input/21t.txt"
â‰¡â—‡âˆ˜ Â°/$"_\n_"
In â†
K  â† ["789" "456" "123" ".0A"] # keypad
D  â† [".^A" "<v>"]             # directions
$keypad K $directions D
Move! â† memo(
  â¨¬(ğ„ˆâŠ‚0_0âŠ¢âŠšâŒ•âŠ™^0Â°âŠŸ # start state: [x y dx dy]
    path(
      â‰¡âŒŸ(âŠ‚â¤š+)Aâ‚‚â†™2       # new states
      â–½âŠ¸â‰¡(â‰ @.â¬š@.ğ„ˆâŠ¡^0â†™2) # filter valid
    | â‰ğ„ˆâŠ¡^0â†™2           # match end state
    )
    â‰¡(ğ„ˆâŠ‚@Aâ‰¡(ğ„ˆâŠ¡">v<^"ğ„ˆâŠ—Aâ‚‚â†˜2)â†˜1) # convert to dirs
  | Â¤Â¤â‹…@A
  )âŠ¸/= # when start=end, just press A 
)
Layer! â† (
  â§ˆâ‚‚(â–¡Move!^0)âŠ‚@A  # starting poz and build pairs
  âˆ§(â™­â‚‚âŠâ—‡ğ„ˆâŠ‚Â°â–¡)âŠ™{""} # combine optimal
)
Optimum â† (
  Layer!K                # keypad robot
  â‰¡(âŠƒ(â§»âŠ¢|â–¡)Layer!D)      # first directions
  /â—‡âŠ‚ â–½=âŠ¸/â†§              # filter shortest
  /â†§waitâ‰¡pool(â§»âŠ¢Layer!D) # second dir best length
)
Partâ‚ â† /+â—¡Ã— â‰¡âŠƒ(â‹•â†™3|Optimum)
# $time âœ(now|$result Partâ‚ In) # it works, but slow
# Part 2 requires 25 layers of D
